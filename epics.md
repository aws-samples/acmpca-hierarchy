# Epics

## Architect the CA hierarchy
| **Story** | **Description** | **Skills required** |
|--|--|--|
| Collect certificate subject information | Gather certificate subject information about the certificate owner: organization name, organization unit, country, state, locality, and common name. | Cloud architect, Security architect, PKI engineer |
| Collect optional information about AWS Organizations | If the CA is to be part of an AWS Organizations structure and the CA hierarchy is to be shared inside, collect the management account number, organizations ID, and optionally the organization unit (OU) ID if the CA hierarchy is only to be shared with a specific OU. Also, determine what, if any, accounts or OUs of the AWS Organizations that the CA is to be shared. | Cloud architect, Security architect, PKI engineer |
| Design the CA hierarchy | Determine which account will house the root and subordinate CAs. Determine how many subordinate levels the hierarchy requires between the root and the end-entity certificates. See [Designing a CA hierarchy](https://docs.aws.amazon.com/acm-pca/latest/userguide/ca-hierarchy.html) for more information. | Cloud architect, Security architect, PKI engineer |
| Determine naming and tagging conventions for the CA hierarchy | Determine the names for the AWS resources: the root CA and each subordinate CA. Determine what tags should be assigned to each CA. | Cloud architect, Security architect, PKI engineer |
| Determine required encryption and signing algorithms | Determine your organization's encryption algorithm requirements for the public keys that your CA uses when it issues a certificate (default is RSA_2048) and key algorithm that your CA uses for certificate signing (default is SHA256WITHRSA). | Cloud architect, Security architect, PKI engineer |
| Determine certificate revocation requirements for the CA hierarchy | If certificate revocation capabilities are required, establish a naming convention for the S3 bucket containing the certificate revocation list (CRL). | Cloud architect, Security architect, PKI engineer |
| Determine the logging requirements for the CA hierarchy | If access logging capabilities are required, establish a naming convention for the S3 bucket containing the access logs. | Cloud architect, Security architect, PKI engineer |
| Determine certificate expiry periods | Determine expiry for the root signing certificate (default is 10 years), end-entity certificates (default is 13 months), and subordinate signing certificates (defaults to 5 year). Each subordinate should expire earlier than the CAs at higher levels in the hierarchy. For more information, see [Managing the private CA lifecycle](https://docs.aws.amazon.com/acm-pca/latest/userguide/ca-lifecycle.html). | Cloud architect, Security architect, PKI engineer |

## Deploy the CA hierarchy
| **Story** | **Description** | **Skills required** |
|--|--|--|
| Fulfill the prequisits for this APG pattern | Consult the Prerequisites for implementing this APG pattern and fulfill each of them. | Cloud administrator, Security engineer, PKI engineer |
| Create CA roles for various personas | Determine the types of AWS Identity & Access Management(AWS IAM) roles or AWS Single Sign-On (AWS SSO) users needed to administrate the various levels of the CA hierarchy, like RootCAdmin, SubordinateCAAdmin, and CertificateConsumer. Determine the granularity of policies needed to seperate duties. Create the required AWS IAM roles or AWS SSO users in the account that the CA hierarchy resides. | Cloud administrator, Security engineer, PKI engineer |
| Deploy the AWS CloudFormation stack | Choose a deployment method, either AWS Console or AWS CLI. Prepare the list of the template parameters required for this implementation. Create the stack using the AWS CloudFormation template provided by this APG pattern. | Cloud administrator, Security engineer, PKI engineer |
| Architect a solution for updating certificates used by customer managed resources | Resources of integrated AWS services, like Elastic Load Balancing, will update certificates automatically during expiry. However, customer managed resources, like web servers running on EC2 instances, will require another mechanism. Determine what customer managed resources will require end-entity certificates from the private CA. Plan a process to be notified about expiry of customer managed resources and update certificates, see [acm-certificate-expiration-check](https://docs.aws.amazon.com/config/latest/developerguide/acm-certificate-expiration-check.html) for one example using AWS Config and [AWS Certificate Manager now provides certificate expiry monitoring through Amazon CloudWatch](https://aws.amazon.com/about-aws/whats-new/2021/03/aws-certificate-manager-provides-certificate-expiry-monitoring-through-amazon-cloudwatch/) for an example using Amazon CloudWatch and Amazon EventBridge. Write custom scripts to update certificates on customer managed resources and integrate them with triggers to automate the updates. For more information about integrated AWS Services, see [Services integrated with AWS Certificate Manager](https://docs.aws.amazon.com/acm/latest/userguide/acm-services.html). | Cloud administrator, Security engineer, PKI engineer |

## Validate and document the CA hierarchy
| **Story** | **Description** | **Skills required** |
|--|--|--|
| Validate optional AWS RAM sharing | If the CA hierarchy is shared with other accounts in an AWS Organizations, login to the AWS Console of one of those accounts, navigate to AWS Private CA, and confirm that the newly created CA is shared to this account. Only the lowest level CA in the hierarchy will be visible as this is the CA that generates the end-entity certificates. Repeat for a sampling of the accounts that the CA is shared with. | Cloud administrator, Security engineer, PKI engineer |
| Validate the CA hierarchy with certificate lifecycle tests | Locate the lifecycle tests provided with this APG pattern. Run the tests that are included to request a certificate, export a certificate, describe a certificate, and delete a certificate from the AWS CLI. | Cloud administrator, Security engineer, PKI engineer |
| Import certificate chain into trust stores | For browsers and other applications to trust a certificate, the certificate’s issuer must be included in the browser’s trust store, which is a list of trusted CAs. Add the certificate chain for the new CA hierarchy to your browser's and application’s trust store. Confirm that the end-entity certificates are trusted. | Cloud administrator, Security engineer, PKI engineer |
| Create a runbook to document the CA hierarchy | Create a runbook document to describe the architecture of the CA hierarchy, the account structure that can request end-entity certificates, the build process, and basic management tasks like end-certificate issuing (unless allowing child account self-service), usage, and tracking. | Cloud administrator, Security engineer, PKI engineer |